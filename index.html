<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bird Blues & Bird Tunes Trainer v3.0</title>
<style>
:root {
  --bg:#121212;--panel:#1a1a1a;--ink:#eee;--ink-dim:#aaa;
  --accent:#ff9800;--accent2:#42a5f5;--barline:#666;--sym:#ffb733;
}
body{margin:0;background:var(--bg);color:var(--ink);font-family:'Courier New',monospace;}
h1{text-align:center;color:var(--accent);margin:16px 0;}
.controls{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin:10px auto;}
.controls label{align-self:center}
.controls select,.controls button{background:#1e1e1e;color:var(--sym);border:1px solid var(--accent);
  padding:6px 12px;border-radius:6px;cursor:pointer;font-weight:bold;min-width:120px;transition:.15s;}
.controls select:hover,.controls button:hover{background:var(--accent);color:#000;}
.btn-secondary{border-color:var(--accent2);color:#9fd2ff;}
.btn-secondary:hover{background:var(--accent2);color:#000;}
.sheet{background:var(--panel);border:2px solid var(--accent);border-radius:10px;padding:16px;
  max-width:1100px;margin:0 auto 16px auto;overflow-x:auto;}
.row{display:grid;grid-template-columns:repeat(4,1fr);min-width:720px;}
.bar{min-height:88px;border-right:2px solid var(--barline);display:flex;flex-direction:column;
  align-items:center;justify-content:center;cursor:pointer;transition:.12s;padding:6px;}
.bar:last-child{border-right:none;}
.bar:hover{background:#222;transform:translateY(-1px);}
.chord{font-size:22px;font-weight:bold;color:var(--sym);}
.roman{font-size:12px;color:var(--ink-dim);}
.analysis{font-size:10px;color:#90caf9;margin-top:3px;display:none;}
.legend{text-align:center;color:#ccc;font-size:12px;margin-bottom:10px;}
.fretboard-section{display:none;background:#1a1a1a;border:2px solid var(--accent);border-radius:8px;
  padding:20px;max-width:1100px;margin:30px auto;}
.fretboard-title{text-align:center;color:var(--accent);margin-bottom:15px;}
.fretboard{display:flex;flex-direction:column;gap:3px;background:#2a2a2a;padding:15px;border-radius:4px;
  overflow-x:auto;}
.string{display:flex;gap:2px;align-items:center;}
.string-label{width:30px;text-align:right;color:#888;font-size:14px;font-weight:bold;}
.fret{width:50px;height:35px;background:#3a3a3a;border:1px solid #555;display:flex;align-items:center;
  justify-content:center;font-size:12px;color:#666;text-align:center;white-space:pre-wrap;}
.fret.highlighted{font-weight:bold;}
@media print{
  body{background:#fff;color:#000}
  .controls,.legend,.fretboard-section{display:none}
  .sheet{border:none;background:#fff}
  h1{font-size:24px;text-align:left;margin-bottom:6px;color:#000}
  .chord{color:#000}.roman{color:#222}
}
</style>
</head>
<body>
<h1>ðŸŽ¶ Bird Blues & Bird Tunes Trainer v3.0</h1>

<div class="controls">
  <label for="tuneSel">Tune:</label>
  <select id="tuneSel"></select>
  <button id="randomTune">Random Bird Tune</button>

  <label for="keySel">Key:</label>
  <select id="keySel">
    <option>C</option><option>F</option><option>Bb</option><option>Eb</option>
    <option>Ab</option><option>Db</option><option>Gb</option><option>B</option>
    <option>E</option><option>A</option><option>D</option><option>G</option><option>F#</option>
  </select>

  <button id="generateBtn">Generate Lead Sheet</button>
  <button id="toggleMode" class="btn-secondary">Switch to Scale Mode</button>
  <button id="toggleAnalysis" class="btn-secondary">Show Analysis</button>
  <button id="printBtn" class="btn-secondary">Print</button>
</div>

<div class="legend">Click a bar to hear its root and view chord tones or scales on the fretboard.</div>

<div id="sheet" class="sheet"></div>
<div id="info" class="info"></div>

<div class="fretboard-section" id="fretboard-section">
  <div class="fretboard-title" id="fretboard-title">Select a chord to view</div>
  <div class="fretboard" id="fretboard"></div>
</div>

<script>
/* ================================
   CORE DATA
==================================*/
const chromaticSharp=['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
const chromaticFlat=['C','Db','D','Eb','E','F','Gb','G','Ab','A','Bb','B'];
const flatKeys=['F','Bb','Eb','Ab','Db','Gb','Cb'];

const NOTE_INDEX={
 'C':0,'B#':0,'C#':1,'Db':1,'D':2,'D#':3,'Eb':3,'E':4,'Fb':4,
 'F':5,'E#':5,'F#':6,'Gb':6,'G':7,'G#':8,'Ab':8,'A':9,
 'A#':10,'Bb':10,'B':11,'Cb':11
};
function indexToNote(i,key){
  const useFlats=flatKeys.includes(key);
  const arr=useFlats?chromaticFlat:chromaticSharp;
  return arr[(i%12+12)%12];
}

/* --- interval colour map --- */
const intervalColors={
 'R':'#ff9800','â™­2':'#00bcd4','2':'#4caf50','â™¯2':'#26c6da',
 'â™­3':'#00acc1','3':'#2196f3','4':'#9c27b0','â™¯4':'#ab47bc',
 '5':'#f44336','â™¯5':'#e57373','â™­6':'#e57373','6':'#fafafa',
 'â™­7':'#fbc02d','7':'#fff59d','9':'#4caf50','11':'#9c27b0','13':'#e0e0e0'
};
const intervalNames={0:'R',1:'â™­2',2:'2',3:'â™­3',4:'3',5:'4',6:'â™¯4',7:'5',8:'â™­6',9:'6',10:'â™­7',11:'7'};

/* --- modes --- */
const modePatterns={
 'Ionian':[0,2,4,5,7,9,11],
 'Dorian':[0,2,3,5,7,9,10],
 'Phrygian':[0,1,3,5,7,8,10],
 'Lydian':[0,2,4,6,7,9,11],
 'Mixolydian':[0,2,4,5,7,9,10],
 'Aeolian':[0,2,3,5,7,8,10],
 'Locrian':[0,1,3,5,6,8,10],
 'Major Bebop':[0,2,4,5,7,8,9,11],
 'Dominant Bebop':[0,2,4,5,7,9,10,11],
 'Minor Bebop':[0,2,3,5,7,8,10,11]
};

/* --- Bird Tunes data (includes extended set) --- */
const birdTunes={
 "Bird Blues":[["IÎ”7","vi7","ii7","V7"],["IÎ”7","IV7","I7","bII7"],["ii7","V7","IÎ”7","V7"]],
 "Blues for Alice":[["Fmaj7","Em7b5","A7","Dm7"],["Gm7","C7","F7","Bb7"],["Bbm7","Eb7","Am7","D7"]],
 "Nowâ€™s the Time":[["I7","IV7","I7","I7"],["IV7","IV7","I7","VI7"],["II7","V7","I7","I7"]],
 "Anthropology":[["IÎ”7","vi7","ii7","V7"],["III7","VI7","II7","V7"],["IÎ”7","III7","VI7","II7"]],
 "Ornithology":[["Gm7","C7","FÎ”7","A7"],["Dm7","G7","CMaj7","F7"],["Bm7b5","E7","Am7","D7"]],
 "Donna Lee":[["AbÎ”7","G7","Cm7","F7"],["Bb7","EbÎ”7","A7","D7"],["Gm7","C7","F7","Bb7"]],
 "Au Privave":[["F7","Bb7","F7","F7"],["Bb7","Bdim7","F7","D7"],["Gm7","C7","F7","C7"]],
 "Barbados":[["F7","Bb7","F7","F7"],["Bb7","Bbm7","F7","D7"],["Gm7","C7","F7","C7"]],
 "Bloomdido":[["Bb7","Eb7","Bb7","Bb7"],["Eb7","EÂ°7","Bb7","G7"],["C7","F7","Bb7","Bb7"]],
 "Chi Chi":[["F7","Bb7","F7","F7"],["Bb7","Bdim7","F7","D7"],["Gm7","C7","F7","F7"]],
 "Cool Blues":[["Bb7","Eb7","Bb7","Bb7"],["Eb7","EÂ°7","Bb7","G7"],["C7","F7","Bb7","Bb7"]],
 "Relaxinâ€™ at Camarillo":[["F7","Bb7","F7","F7"],["Bb7","Bdim7","F7","D7"],["Gm7","C7","F7","C7"]],
 "Moose the Mooche":[["BbÎ”7","G7","C7","F7"],["BbÎ”7","G7","C7","F7"],["D7","G7","C7","F7"]],
 "Steeplechase":[["BbÎ”7","G7","C7","F7"],["BbÎ”7","G7","C7","F7"],["D7","G7","C7","F7"]],
 "Dexterity":[["BbÎ”7","G7","C7","F7"],["BbÎ”7","G7","C7","F7"],["D7","G7","C7","F7"]],
 "Leap Frog":[["BbÎ”7","G7","C7","F7"],["BbÎ”7","G7","C7","F7"],["D7","G7","C7","F7"]],
 "Ko-Ko":[["BbÎ”7","A7","D7","G7"],["C7","F7","BbÎ”7","F7"],["BbÎ”7","A7","D7","G7"]],
 "Yardbird Suite":[["CÎ”7","A7","D7","G7"],["CÎ”7","A7","D7","G7"],["F7","E7","A7","D7"]],
 "Embraceable You":[["CÎ”7","A7","Dm7","G7"],["CÎ”7","A7","Dm7","G7"],["F7","E7","A7","D7"]],
 "My Old Flame":[["EbÎ”7","C7","Fm7","Bb7"],["EbÎ”7","C7","Fm7","Bb7"],["Ab7","G7","C7","F7"]],
 "Lover Man":[["CÎ”7","A7","Dm7","G7"],["CÎ”7","A7","Dm7","G7"],["F7","E7","A7","D7"]]
};

/* --- populate dropdown --- */
const tuneSel=document.getElementById('tuneSel');
Object.keys(birdTunes).forEach(t=>{
  const o=document.createElement('option');
  o.textContent=t;
  tuneSel.appendChild(o);
}); /* ================================
   AUDIO SETUP
==================================*/
const freqBase={'C':261.63,'C#':277.18,'Db':277.18,'D':293.66,'Eb':311.13,'E':329.63,'F':349.23,
'F#':369.99,'Gb':369.99,'G':392,'Ab':415.30,'A':440,'Bb':466.16,'A#':466.16,'B':493.88};
const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
let audioUnlocked=false;
document.addEventListener('pointerdown',()=>{if(!audioUnlocked){audioCtx.resume();audioUnlocked=true;}},{once:true});

/* ================================
   FRETFBOARD
==================================*/
const stringNotes=['E','B','G','D','A','E'];
function indexToPitch(open,f,key){return indexToNote(NOTE_INDEX[open]+f,key);}
function buildFretboard(){
 const fb=document.getElementById('fretboard');fb.innerHTML='';
 const key=keySel.value;
 stringNotes.forEach(s=>{
  const row=document.createElement('div');row.className='string';
  const lab=document.createElement('div');lab.className='string-label';lab.textContent=s;row.appendChild(lab);
  for(let f=0;f<=12;f++){
    const fr=document.createElement('div');fr.className='fret';
    const note=indexToPitch(s,f,key);fr.dataset.note=note;if(f===0)fr.textContent=s;row.appendChild(fr);
  }fb.appendChild(row);
 });
}
function clearFretboard(){document.querySelectorAll('.fret').forEach(fr=>{fr.className='fret';fr.textContent='';});}

/* ================================
   THEORY HELPERS + RENDERING
==================================*/
const IONIAN=[0,2,4,5,7,9,11];
const DEGREE_TO_NUM={'I':1,'II':2,'III':3,'IV':4,'V':5,'VI':6,'VII':7};
const NUM_TO_ROMAN=['I','II','III','IV','V','VI','VII'];

function majorScale(k){return IONIAN.map(i=>indexToNote(NOTE_INDEX[k]+i,k));}

function detectKey(tune){
 for(const r of tune)for(const s of r){if(/Î”|maj7|Maj7/i.test(s)){const m=s.match(/^([A-G](#|b)?)/);if(m)return m[1];}}
 for(const r of tune)for(const s of r){const m=s.match(/^([A-G](#|b)?)/);if(m)return m[1];}
 return'C';
}

function parseChordSymbol(sym,key,shift=0){
 const roman=sym.match(/^([b#]?)(I{1,3}|IV|V|VI{0,2}|VII)(.*)$/i);
 if(roman){
  const[,acc,rom,ext]=roman;const deg=DEGREE_TO_NUM[rom.toUpperCase()];
  const isMin=rom===rom.toLowerCase();const a=acc==='b'?-1:acc==='#'?1:0;
  const root=indexToNote(NOTE_INDEX[key]+IONIAN[deg-1]+a+shift,key);
  let q='dom7',suf='7',mode='Mixolydian';
  if(/Î”|maj/i.test(ext)){q='maj7';suf='Î”7';mode='Ionian';}
  else if(/Â°|dim/i.test(ext)){q='dim7';suf='Â°7';mode='Locrian';}
  else if(isMin){q='m7';suf='m7';mode='Dorian';}
  if(/m7b5|Ã¸/i.test(ext)){q='m7b5';suf='m7b5';mode='Locrian';}
  return{root,displaySuffix:suf,quality:q,romanDisplay:(acc||'')+rom+suf,mode};
 }
 const m=sym.match(/^([A-G](#|b)?)(.*)$/);if(!m)return{root:key,displaySuffix:'Î”7',quality:'maj7',romanDisplay:'IÎ”7',mode:'Ionian'};
 let[,root,_,rest]=m;root=indexToNote(NOTE_INDEX[root]+shift,key);
 let q
