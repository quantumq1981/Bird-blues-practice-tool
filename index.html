<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bird Blues â€” Pro Lead Sheet & Fretboard Trainer</title>
<style>
:root {
  --bg:#121212;--panel:#1a1a1a;--ink:#eee;--ink-dim:#aaa;
  --accent:#ff9800;--accent2:#42a5f5;--barline:#666;--sym:#ffb733;
}
body{margin:0;background:var(--bg);color:var(--ink);font-family:'Courier New',monospace;}
h1{text-align:center;color:var(--accent);margin:16px 0;}
.controls{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin:10px auto;}
.controls select,.controls button{background:#1e1e1e;color:var(--sym);border:1px solid var(--accent);
  padding:6px 12px;border-radius:6px;cursor:pointer;font-weight:bold;min-width:120px;transition:.15s;}
.controls select:hover,.controls button:hover{background:var(--accent);color:#000;}
.btn-secondary{border-color:var(--accent2);color:#9fd2ff;}
.btn-secondary:hover{background:var(--accent2);color:#000;}
.sheet{background:var(--panel);border:2px solid var(--accent);border-radius:10px;padding:16px;
  max-width:1100px;margin:0 auto 16px auto;overflow-x:auto;}
.row{display:grid;grid-template-columns:repeat(4,1fr);min-width:720px;}
.bar{min-height:88px;border-right:2px solid var(--barline);display:flex;flex-direction:column;
  align-items:center;justify-content:center;cursor:pointer;transition:.12s;}
.bar:last-child{border-right:none;}
.bar:hover{background:#222;transform:translateY(-1px);}
.chord{font-size:22px;font-weight:bold;color:var(--sym);}
.roman{font-size:12px;color:var(--ink-dim);}
.bebop{font-size:11px;color:#90caf9;opacity:.9;margin-top:4px;}
.legend{text-align:center;color:#ccc;font-size:12px;margin-bottom:10px;}
.fretboard-section{display:none;background:#1a1a1a;border:2px solid var(--accent);border-radius:8px;
  padding:20px;max-width:1100px;margin:30px auto;}
.fretboard-title{text-align:center;color:var(--accent);margin-bottom:15px;}
.fretboard{display:flex;flex-direction:column;gap:3px;background:#2a2a2a;padding:15px;border-radius:4px;
  overflow-x:auto;}
.string{display:flex;gap:2px;align-items:center;}
.string-label{width:30px;text-align:right;color:#888;font-size:14px;font-weight:bold;}
.fret{width:50px;height:35px;background:#3a3a3a;border:1px solid #555;display:flex;align-items:center;
  justify-content:center;font-size:12px;color:#666;text-align:center;white-space:pre-wrap;}
.fret.highlighted{font-weight:bold;}
@media print{
  body{background:#fff;color:#000}
  .controls,.legend,.fretboard-section{display:none}
  .sheet{border:none;background:#fff}
  h1{font-size:24px;text-align:left;margin-bottom:6px;color:#000}
  .chord{color:#000}.roman{color:#222}
}
</style>
</head>
<body>
<h1>ðŸŽ¶ Bird Blues â€” Pro Lead Sheet & Fretboard Trainer</h1>
<div class="controls">
  <label for="keySel">Key:</label>
  <select id="keySel">
    <option>C</option><option>F</option><option>Bb</option><option>Eb</option>
    <option>Ab</option><option>Db</option><option>Gb</option><option>B</option>
    <option>E</option><option>A</option><option>D</option><option>G</option><option>F#</option>
  </select>
  <button id="generateBtn">Generate Lead Sheet</button>
  <button id="toggleMode" class="btn-secondary">Switch to Scale Mode</button>
  <button id="printBtn" class="btn-secondary">Print Lead Sheet</button>
</div>
<div class="legend">Click a bar to hear its root and view chord tones or scale across the fretboard.</div>
<div id="sheet" class="sheet"></div>
<div id="info" class="info"></div>
<div class="fretboard-section" id="fretboard-section">
  <div class="fretboard-title" id="fretboard-title">Select a chord to view</div>
  <div class="fretboard" id="fretboard"></div>
</div>

<script>
/* === CORE CONSTANTS === */
const chromaticSharp=['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
const chromaticFlat=['C','Db','D','Eb','E','F','Gb','G','Ab','A','Bb','B'];
const flatKeys=['F','Bb','Eb','Ab','Db','Gb','Cb'];
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
const freqBase={'C':261.63,'C#':277.18,'Db':277.18,'D':293.66,'Eb':311.13,'E':329.63,
'F':349.23,'F#':369.99,'Gb':369.99,'G':392.00,'G#':415.30,'Ab':415.30,'A':440.00,
'Bb':466.16,'B':493.88};

/* === MODES (Ionianâ€“Locrian) === */
const modePatterns={
 'Ionian':[0,2,4,5,7,9,11],
 'Dorian':[0,2,3,5,7,9,10],
 'Phrygian':[0,1,3,5,7,8,10],
 'Lydian':[0,2,4,6,7,9,11],
 'Mixolydian':[0,2,4,5,7,9,10],
 'Aeolian':[0,2,3,5,7,8,10],
 'Locrian':[0,1,3,5,6,8,10],
 'Lydian â™¯2':[0,3,4,6,7,9,11],
 'Altered':[0,1,3,4,6,8,10],
 'Whole Tone':[0,2,4,6,8,10],
 'Diminished':[0,2,3,5,6,8,9,11]
};

function useFlats(k){return flatKeys.includes(k);}
function clearFretboard(){document.querySelectorAll('.fret').forEach(fr=>{fr.className='fret';fr.textContent='';});}
function getNoteAtFret(s,f){const chromatic=chromaticFlat;const i=chromatic.indexOf(s);return chromatic[(i+f)%12];}
function buildFretboard(){
  const fb=document.getElementById('fretboard');fb.innerHTML='';
  const strings=['E','B','G','D','A','E'];
  strings.forEach(s=>{
    const row=document.createElement('div');row.className='string';
    const lab=document.createElement('div');lab.className='string-label';lab.textContent=s;row.appendChild(lab);
    for(let f=0;f<=12;f++){const fr=document.createElement('div');fr.className='fret';fr.dataset.note=getNoteAtFret(s,f);row.appendChild(fr);}
    fb.appendChild(row);
  });
}

/* === INTERVAL COLOR LOGIC === */
const intervalColors={'R':'#ff9800','â™­2':'#00bcd4','2':'#4caf50','â™¯2':'#26c6da','â™­3':'#00acc1','3':'#2196f3',
'4':'#9c27b0','â™¯4':'#ab47bc','5':'#f44336','â™­6':'#e57373','6':'#fafafa','â™­7':'#fbc02d','7':'#fff59d'};
const intervalNames={0:'R',1:'â™­2',2:'2',3:'â™­3',4:'3',5:'4',6:'â™¯4',7:'5',8:'â™­6',9:'6',10:'â™­7',11:'7'};

let showScaleMode=false,currentScale=null;

/* === CORE VISUALIZATION === */
function showOnFretboard(root,modeName){
  clearFretboard();
  const chromatic=useFlats(keySel.value)?chromaticFlat:chromaticSharp;
  const rootIdx=chromatic.indexOf(root);
  const modeInts=modePatterns[modeName]||[];
  document.querySelectorAll('.fret').forEach(fr=>{
    const note=fr.dataset.note;
    const noteIdx=chromatic.indexOf(note);
    const interval=(noteIdx-rootIdx+12)%12;
    if(modeInts.includes(interval)){
      const label=intervalNames[interval]||'?';
      fr.classList.add('highlighted');
      fr.style.background=intervalColors[label]||'#2a2a2a';
      fr.textContent=`${note}\n${label}`;
    }
  });
  document.getElementById('fretboard-section').style.display='block';
  document.getElementById('fretboard-title').textContent=`${modeName} for ${root}`;
  currentScale={root,modeName};
}

/* === PLAYBACK === */
function playScale(root,modeName){
  const pattern=modePatterns[modeName];if(!pattern)return;
  const chromatic=useFlats(keySel.value)?chromaticFlat:chromaticSharp;
  const rootIdx=chromatic.indexOf(root);
  const notes=pattern.map(i=>chromatic[(rootIdx+i)%12]);
  const seq=[...notes,...notes.slice().reverse().slice(1)];
  const tempo=100,dur=60/tempo;
  seq.forEach((n,i)=>{
    const osc=audioCtx.createOscillator(),g=audioCtx.createGain();
    osc.type='sine';osc.frequency.value=freqBase[n]||440;g.gain.value=0.1;
    osc.connect(g);g.connect(audioCtx.destination);
    osc.start(audioCtx.currentTime+i*dur);
    osc.stop(audioCtx.currentTime+(i+1)*dur);
  });
}

/* === LEGEND === */
const legendDiv=document.createElement('div');
legendDiv.style.display='flex';legendDiv.style.flexWrap='wrap';
legendDiv.style.justifyContent='center';legendDiv.style.gap='8px';legendDiv.style.marginTop='10px';
legendDiv.innerHTML=Object.entries(intervalColors).map(([lbl,col])=>`
 <div style="display:flex;align-items:center;gap:4px;">
 <div style="width:18px;height:18px;background:${col};border:1px solid #555"></div>
 <span style="font-size:12px;color:#ccc">${lbl}</span></div>`).join('');
document.getElementById('fretboard-section').appendChild(legendDiv);

/* === SAMPLE LEAD SHEET === */
const chords=[['C7','Mixolydian'],['A7','Mixolydian'],['D7','Mixolydian'],['G7','Mixolydian']];
function renderLeadSheet(){
  const sheet=document.getElementById('sheet');sheet.innerHTML='';
  const row=document.createElement('div');row.className='row';
  chords.forEach(([sym,mode])=>{
    const bar=document.createElement('div');bar.className='bar';
    bar.innerHTML=`<div class='chord'>${sym}</div><div class='roman'>${mode}</div>`;
    bar.onclick=()=>{playRoot(sym[0]);showOnFretboard(sym[0],mode);};
    row.appendChild(bar);
  });
  sheet.appendChild(row);
}
function playRoot(n){const osc=audioCtx.createOscillator(),g=audioCtx.createGain();
  osc.type='sine';osc.frequency.value=freqBase[n]||440;g.gain.value=0.1;
  osc.connect(g);g.connect(audioCtx.destination);osc.start();osc.stop(audioCtx.currentTime+0.6);}
renderLeadSheet();buildFretboard();

/* === CONTROLS === */
document.getElementById('generateBtn').onclick=renderLeadSheet;
document.getElementById('toggleMode').onclick=()=>{showScaleMode=!showScaleMode;
  document.getElementById('toggleMode').textContent=showScaleMode?'Switch to Chord Mode':'Switch to Scale Mode';};
document.getElementById('printBtn').onclick=()=>window.print();

/* === PLAY SCALE BUTTON === */
const playBtn=document.createElement('button');
playBtn.textContent='Play Scale';playBtn.className='btn-secondary';playBtn.style.marginTop='10px';
playBtn.onclick=()=>{if(currentScale)playScale(currentScale.root,currentScale.modeName);};
document.getElementById('fretboard-section').appendChild(playBtn);
</script>
</body>
</html>
