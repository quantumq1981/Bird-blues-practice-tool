<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bird Blues â€” Lead Sheet & Fretboard Trainer</title>
<style>
:root {
  --bg:#121212;--panel:#1a1a1a;--ink:#eee;--ink-dim:#aaa;
  --accent:#ff9800;--accent2:#42a5f5;--barline:#666;--sym:#ffb733;
}
body{margin:0;background:var(--bg);color:var(--ink);font-family:'Courier New',monospace;}
h1{text-align:center;color:var(--accent);margin:16px 0;}
.controls{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin:10px auto;}
.controls select,.controls button{background:#1e1e1e;color:var(--sym);border:1px solid var(--accent);
  padding:6px 12px;border-radius:6px;cursor:pointer;font-weight:bold;min-width:120px;transition:.15s;}
.controls select:hover,.controls button:hover{background:var(--accent);color:#000;}
.btn-secondary{border-color:var(--accent2);color:#9fd2ff;}
.btn-secondary:hover{background:var(--accent2);color:#000;}
.sheet{background:var(--panel);border:2px solid var(--accent);border-radius:10px;padding:16px;
  max-width:1100px;margin:0 auto 16px auto;overflow-x:auto;}
.row{display:grid;grid-template-columns:repeat(4,1fr);min-width:720px;}
.bar{min-height:88px;border-right:2px solid var(--barline);display:flex;flex-direction:column;
  align-items:center;justify-content:center;cursor:pointer;transition:.12s;}
.bar:last-child{border-right:none;}
.bar:hover{background:#222;transform:translateY(-1px);}
.chord{font-size:22px;font-weight:bold;color:var(--sym);}
.roman{font-size:12px;color:var(--ink-dim);}
.bebop{font-size:11px;color:#90caf9;opacity:.9;margin-top:4px;}
.legend{text-align:center;color:#ccc;font-size:12px;margin-bottom:10px;}
.fretboard-section{display:none;background:#1a1a1a;border:2px solid var(--accent);border-radius:8px;
  padding:20px;max-width:1100px;margin:30px auto;}
.fretboard-title{text-align:center;color:var(--accent);margin-bottom:15px;}
.fretboard{display:flex;flex-direction:column;gap:3px;background:#2a2a2a;padding:15px;border-radius:4px;
  overflow-x:auto;}
.string{display:flex;gap:2px;align-items:center;}
.string-label{width:30px;text-align:right;color:#888;font-size:14px;font-weight:bold;}
.fret{width:50px;height:35px;background:#3a3a3a;border:1px solid #555;display:flex;align-items:center;
  justify-content:center;font-size:12px;color:#666;}
.fret.highlighted{font-weight:bold;}
.fret.root{background:#ff9800;color:#000;border-color:#ffb733;}
.fret.sub{background:#42a5f5;color:#000;border-color:#64b5f6;}
.fret.dom{background:#ef5350;color:#000;border-color:#e57373;}
.fret.alt{background:#ffee58;color:#000;border-color:#fff176;}
.fret.ext9{background:#4caf50;color:#000;border-color:#66bb6a;}
.fret.ext11{background:#7e57c2;color:#000;border-color:#9575cd;}
.fret.ext13{background:#e0e0e0;color:#000;border-color:#fff;}
@media print{
  body{background:#fff;color:#000}
  .controls,.legend,.fretboard-section{display:none}
  .sheet{border:none;background:#fff}
  h1{font-size:24px;text-align:left;margin-bottom:6px;color:#000}
  .chord{color:#000}.roman{color:#222}
}
</style>
</head>
<body>
<h1>ðŸŽ¶ Bird Blues â€” Lead Sheet & Fretboard Trainer</h1>
<div class="controls">
  <label for="keySel">Key:</label>
  <select id="keySel">
    <option>C</option><option>F</option><option>Bb</option><option>Eb</option>
    <option>Ab</option><option>Db</option><option>Gb</option><option>B</option>
    <option>E</option><option>A</option><option>D</option><option>G</option><option>F#</option>
  </select>
  <button id="generateBtn">Generate Lead Sheet</button>
  <button id="toggleMode" class="btn-secondary">Switch to Scale Mode</button>
  <button id="printBtn" class="btn-secondary">Print Lead Sheet</button>
</div>
<div class="legend">Click a bar to hear its root and view chord tones or scale across the fretboard.</div>
<div id="sheet" class="sheet"></div>
<div id="info" class="info"></div>
<div class="fretboard-section" id="fretboard-section">
  <div class="fretboard-title" id="fretboard-title">Select a chord to view</div>
  <div class="fretboard" id="fretboard"></div>
</div>

<script>
const chromaticSharp=['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
const chromaticFlat=['C','Db','D','Eb','E','F','Gb','G','Ab','A','Bb','B'];
const flatKeys=['F','Bb','Eb','Ab','Db','Gb','Cb'];
const romanSemitoneMap={'I':0,'II':2,'III':4,'IV':5,'V':7,'VI':9,'VII':11,'â™­II':1,'â™­III':3,'â™­V':6,'â™­VI':8,'â™­VII':10,'â™¯IV':6};
const modePatterns={
 'Ionian':[0,2,4,5,7,9,11],'Dorian':[0,2,3,5,7,9,10],'Phrygian':[0,1,3,5,7,8,10],
 'Lydian':[0,2,4,6,7,9,11],'Mixolydian':[0,2,4,5,7,9,10],'Aeolian':[0,2,3,5,7,8,10],
 'Locrian':[0,1,3,5,6,8,10],'Bebop Major':[0,2,4,5,7,8,9,11],'Bebop Dominant':[0,2,4,5,7,9,10,11]
};
const parkerBluesSegments=[
 [[{d:'I',q:'Î”7'},{d:'â™­III',q:'Â°7'},{d:'II',q:'7'},{d:'â™­II',q:'7'}],
  [{d:'IIm',q:'7'},{d:'V',q:'7'},{d:'I',q:'7'},{d:'IV',q:'7'}]],
 [[{d:'IVm',q:'7'},{d:'â™­VII',q:'7'},{d:'III',q:'7'},{d:'VI',q:'7'}],
  [{d:'II',q:'7'},{d:'V',q:'7'},{d:'I',q:'Î”7'},{d:'â™­VI',q:'7'}]],
 [[{d:'I',q:'Î”7'},{d:'â™¯IV',q:'Â°7'},{d:'IV',q:'7'},{d:'â™­VII',q:'7'}],
  [{d:'IIm',q:'7'},{d:'V',q:'7'},{d:'â™­II',q:'7'},{d:'I',q:'Î”7'}]]
];
const scaleHints={'Î”7':'Major â€¢ Lydian â€¢ Bebop Major','7':'Mixolydian â€¢ Bebop Dominant â€¢ Altered',
 'm7':'Dorian â€¢ Aeolian â€¢ Melodic Minor','Â°7':'Diminished â€¢ Wholeâ€“Half'};
let showScaleMode=false;
document.getElementById('toggleMode').addEventListener('click',()=>{
  showScaleMode=!showScaleMode;
  document.getElementById('toggleMode').textContent=showScaleMode?'Switch to Chord Tone Mode':'Switch to Scale Mode';
});
function useFlats(k){return flatKeys.includes(k);}
function getChordSymbolObj(o,key){
  const flats=useFlats(key),scale=flats?chromaticFlat:chromaticSharp;
  const isMinor=o.d.endsWith('m'),deg=isMinor?o.d.slice(0,-1):o.d;
  const rootIdx=scale.indexOf(key),intv=romanSemitoneMap[deg]||0;
  const note=scale[(rootIdx+intv+12)%12];
  const qual=isMinor&&o.q==='7'?'m7':isMinor?('m'+o.q):o.q;
  return{note,qual,chord:`${note}${qual}`,roman:`${deg}${qual}`,hint:scaleHints[qual]||'â€”'};
}
function generateRandomParkerForm(){
  const all=parkerBluesSegments.flat();const prog=[];
  while(prog.length<12){const r=all[Math.floor(Math.random()*all.length)];prog.push(...r);}
  return prog.slice(0,12);
}
function buildChartData(k){
  const p=generateRandomParkerForm();
  const rows=[p.slice(0,4),p.slice(4,8),p.slice(8,12)];
  return rows.map(r=>r.map(c=>getChordSymbolObj(c,k)));
}
// Fretboard
const stringNotes=['E','B','G','D','A','E'];
function buildFretboard(){
  const fb=document.getElementById('fretboard');fb.innerHTML='';
  stringNotes.forEach(s=>{
    const row=document.createElement('div');row.className='string';
    const lab=document.createElement('div');lab.className='string-label';lab.textContent=s;row.appendChild(lab);
    for(let f=0;f<=12;f++){
      const fr=document.createElement('div');fr.className='fret';fr.dataset.note=getNoteAtFret(s,f);
      if(f===0)fr.textContent=s;row.appendChild(fr);
    }fb.appendChild(row);
  });
}
function getNoteAtFret(s,f){
  const chromatic=useFlats(keySel.value)?chromaticFlat:chromaticSharp;
  const i=chromatic.indexOf(s);return chromatic[(i+f)%12];
}
function clearFretboard(){document.querySelectorAll('.fret').forEach(fr=>{fr.className='fret';});}
function getChordTones(quality,root){
  const intervals={'Î”7':[0,4,7,11],'7':[0,4,7,10],'m7':[0,3,7,10],'Â°7':[0,3,6,9]};
  const degs=['R','3','5','7'];const chromatic=useFlats(keySel.value)?chromaticFlat:chromaticSharp;
  const idx=chromatic.indexOf(root);
  return(intervals[quality]||[0,4,7]).map((i,n)=>({note:chromatic[(idx+i)%12],degree:degs[n]}));
}
function inferModeFromHint(hint){
  return Object.keys(modePatterns).find(m=>hint.includes(m))||'Ionian';
}
function showOnFretboard(root,chordTones,modeName){
  clearFretboard();
  const chromatic=useFlats(keySel.value)?chromaticFlat:chromaticSharp;
  const rootIdx=chromatic.indexOf(root);
  const modeInts=modePatterns[modeName]||[];
  const scaleNotes=modeInts.map(i=>chromatic[(rootIdx+i)%12]);
  document.querySelectorAll('.fret').forEach(fr=>{
    const note=fr.dataset.note;
    if(showScaleMode){
      if(scaleNotes.includes(note)){
        fr.classList.add('highlighted');
        if(note===root)fr.classList.add('root');
        else{
          const pos=modeInts.indexOf((chromatic.indexOf(note)-rootIdx+12)%12);
          if([1,2].includes(pos))fr.classList.add('ext9');
          else if([3,4].includes(pos))fr.classList.add('ext11');
          else if([5,6].includes(pos))fr.classList.add('ext13');
        }
      }
    }else{
      const match=chordTones.find(ct=>ct.note===note);
      if(match){
        fr.classList.add('highlighted');
        if(match.degree==='R')fr.classList.add('root');
        else if(match.degree==='3')fr.classList.add('sub');
        else if(match.degree==='5')fr.classList.add('dom');
        else if(match.degree==='7')fr.classList.add('alt');
      }
    }
  });
  document.getElementById('fretboard-section').style.display='block';
  document.getElementById('fretboard-title').textContent=
    showScaleMode?`${modeName} Scale for ${root}`:`Chord Tones for ${root}`;
}
// Audio
const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
const freqBase={'C':261.63,'C#':277.18,'Db':277.18,'D':293.66,'Eb':311.13,'E':329.63,'F':349.23,'F#':369.99,
 'Gb':369.99,'G':392,'Ab':415.3,'A':440,'Bb':466.16,'B':493.88};
function playRoot(note){
 try{
   const osc=audioCtx.createOscillator(),g=audioCtx.createGain();
   osc.type='sine';osc.frequency.value=freqBase[note]||440;g.gain.value=0.001;
   osc.connect(g);g.connect(audioCtx.destination);
   const t=audioCtx.currentTime;
   g.gain.exponentialRampToValueAtTime(0.2,t+0.02);
   g.gain.exponentialRampToValueAtTime(0.0001,t+0.9);
   osc.start(t);osc.stop(t+1);
 }catch(e){console.log(e);}
}
// Render
const keySel=document.getElementById('keySel'),sheet=document.getElementById('sheet'),info=document.getElementById('info');
function renderLeadSheet(k){
 sheet.innerHTML='';
 const data=buildChartData(k);
 data.forEach(r=>{
   const row=document.createElement('div');row.className='row';
   r.forEach(c=>{
     const bar=document.createElement('div');bar.className='bar';
     bar.title=`Scales: ${c.hint}`;
     bar.innerHTML=`<div class='chord'>${c.chord}</div><div class='roman'>${c.roman}</div><div class='bebop'>${c.hint}</div>`;
     bar.addEventListener('click',()=>{
       playRoot(c.note);
       const tones=getChordTones(c.qual,c.note);
       const mode=inferModeFromHint(c.hint);
       showOnFretboard(c.note,tones,mode);
     });
     row.appendChild(bar);
   });
   sheet.appendChild(row);
 });
 info.innerHTML=`<strong>Bird Blues in ${k}</strong><br><span style="color:#888">Click bars to visualize on fretboard and hear roots.</span>`;
}
renderLeadSheet('C');
keySel.addEventListener('change',()=>renderLeadSheet(keySel.value));
document.getElementById('generateBtn').addEventListener('click',()=>renderLeadSheet(keySel.value));
document.getElementById('printBtn').addEventListener('click',()=>window.print());
buildFretboard();
</script>
</body>
</html>
